---
title: "Migration- Data Visualization Project"
author: "Jose Andres, Max, Richa Gupta, Sam"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE, prompt=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)

# Load packages.
packages <- c("ggplot2", "tidyverse", "wbstats", "rgdal", "leaflet")

packages <- lapply(packages, FUN = function(x) {
  if(!require(x, character.only = TRUE)) {
    install.packages(x, repos = "http://cran.us.r-project.org")
    library(x, character.only = TRUE)
  }
})

# Removing scientific notation
options(scipen = 999)
```


# The plight of migration {.tabset .tabset-fade}

## Introduction {.tabset .tabset-fade .tabset-pills}


```{r}
# SM.POP.NETM - World bank indicator for Net migration- total number of migrants
# SP.POP.TOTL - World bank indicator for Total population- total population
mig_pop <- wbstats::wb(country = "countries_only",indicator = c("SM.POP.NETM", "SP.POP.TOTL"),  startdate = "2007", enddate = "2020", return_wide = TRUE)

# Variable to calcualte migration per population
mig_pop$mig_by_pop <- mig_pop$SM.POP.NETM / mig_pop$SP.POP.TOTL

# Converting date to integer from string
mig_pop$date <- mig_pop$date %>% as.numeric()

# mig_pop %>%
#   ggplot(aes(x = date, y = mig_by_pop, color = country)) +
#   geom_point() +
#   geom_line(data = mig_pop[!is.na(mig_pop$mig_by_pop),], aes(group = country)) +
#   theme(legend.position = "none")

```
The most recent data in World Bank is available for the year 2017.

```{r}
# Extract top 3 and least 3 countries for labels
top3 <-  mig_pop %>%
  filter(date == 2017 & !is.na(mig_by_pop)) %>%
  arrange(desc(mig_by_pop)) %>%
  head(n = 3) %>%
  select(country, mig_by_pop)

least4 <- mig_pop %>%
  filter(date == 2017 & !is.na(mig_by_pop)) %>%
  arrange(desc(mig_by_pop)) %>%
  tail(n = 4) %>%
  select(country, mig_by_pop)

mig_pop %>%
  filter(date == 2017) %>%
  ggplot() +
  geom_bar(aes(y = mig_by_pop, x = country), stat = "identity", na.rm = TRUE) +
  xlab(NULL) + ylab("migration per person in the country") +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +
  geom_text(data = top3, aes(x = country, y = mig_by_pop, label = country), color = "green", check_overlap = TRUE, vjust = 0, nudge_y = 0.01) +
  geom_text(data = least4, aes(x = country, y = mig_by_pop, label = country), color = "red", check_overlap = TRUE, vjust = 0, nudge_y = -0.01)
  
```
This graph shows that some countries stand out with higher than normal immigration like Bahrain, Maldives and Oman whereas some other countries are standing out because of all the people moving out of them. For example in Syria, for every 100 people in the country 12 people are moving to other countries.

We are interested in understanding what are the reasons that are making these people move out of their home countries.

We are removing Puerto Rico from our observations due to the fact that it is a part of United States and most of the migration that Puerto Rico faces is still inside of the country.

We are more interested in seeing the movement of people within countries and the reasons due to which this happens.



## Venezuela {.tabset .tabset-fade .tabset-pills}

```{r child='venezuela.Rmd'}
```

## South Sudan {.tabset .tabset-fade .tabset-pills}

```{r child = 'southsudan.Rmd'}
```

## Syria {.tabset .tabset-fade .tabset-pills}

```{r child = 'syria.Rmd'}
```



