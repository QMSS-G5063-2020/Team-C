#round rate to two decimal places
df$`Per 1,000 Rate` <- round(df$`Per 1,000 Rate`, digits = 1)
df <- mutate(df,
type = case_when(
`Per 1,000 Rate` > 0  ~ "Inflow",
`Per 1,000 Rate` < 0  ~ "Outflow",
TRUE                  ~  "Data Not Avalilable or Marginal"
)
#merges country coordinates based on iso coding
colnames(df)[colnames(df) == "iso3c"] <- "ISO3"
combined <- world_spdf@data %>%
left_join(df, by = c(ISO3 = "ISO3"))
inflow_spdf <- world_spdf
outflow_spdf <- world_spdf
#adds merged data into sp df
world_spdf@data <- combined
df_outflow <- df %>% filter(date=="2017"&type=="Outflow")
qpal_outflow <- colorQuantile("Reds",df_outflow$`Per 1,000 Rate`)
df_inflow <- df %>% filter(date=="2017"&type=="Inflow")
qpal_inflow <- colorQuantile("Blues",df_inflow$`Per 1,000 Rate`)
combined <- world_spdf@data %>%
left_join(df, by = c(ISO3 = "ISO3"))
content_inflow <- paste("Country:",df$country,"<br/>",
"Region:",df$region,"<br/>",
"Duration:",df$`Per 1,000 Rate`,"<br/>")
content_outflow <- paste("Country:",df$country,"<br/>",
"Region:",df$region,"<br/>",
"Duration:",df$`Per 1,000 Rate`,"<br/>")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Outflow",
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(df_outflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = df_outflow$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add inflows migration
addPolygons(stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = `Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration inflow Per 1000")# %>%
##Controls of the migration flows
# addLayersControl(overlayGroups = c("Inflow", "Outflow"))
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add inflows migration
addPolygons(stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = `Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration inflow Per 1000")# %>%
##Controls of the migration flows
# addLayersControl(overlayGroups = c("Inflow", "Outflow"))
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add inflows migration
addPolygons(stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = `Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration inflow Per 1000")# %>%
##Controls of the migration flows
# addLayersControl(overlayGroups = c("Inflow", "Outflow"))
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add inflows migration
addPolygons(stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = `Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration inflow Per 1000")
# %>%
##Controls of the migration flows
# addLayersControl(overlayGroups = c("Inflow", "Outflow"))
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Outflow",
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(df_outflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = df_outflow$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Outflow",
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(df_outflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = df_outflow$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000") %>%
addPolygons(stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = `Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration inflow Per 1000")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Outflow",
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(df_outflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = df_outflow$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000") %>%
addPolygons(stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = `Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration inflow Per 1000") %>%
addLayersControl(overlayGroups = c("Inflow", "Outflow"))
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Outflow",
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(df_outflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = df_outflow$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Outflow", popup = content_outflow,
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(df_outflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = df_outflow$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Outflow",
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(df_outflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = df_outflow$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Inflow",
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(df_inflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = df_inflow$`Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration Inflow Per 1000")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Outflow",
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(df_outflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = df_outflow$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Inflow",
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(df_inflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = df_inflow$`Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration Inflow Per 1000")
df_inflow$`Per 1,000 Rate`
df_inflow$region
filter(df_inflow$region)
filter(df_inflow$region=="Latin America & Caribbean ")
filter(df_inflow,df_inflow$region=="Latin America & Caribbean ")
filter(df_outflow,df_outflow$region=="Latin America & Caribbean ")
filter(df_inflow,df_inflow$region=="Latin America & Caribbean ")
content_inflow <- paste("Country:",df_inflow$country,"<br/>",
"Region:",df_inflow$region,"<br/>",
"Migration Rate:",df_inflow$`Per 1,000 Rate`,"<br/>")
content_outflow <- paste("Country:",df_outflow$country,"<br/>",
"Region:",df_outflow$region,"<br/>",
"Duration:",df_outflow$`Per 1,000 Rate`,"<br/>")
content_outflow <- paste("Country:",df_outflow$country,"<br/>",
"Region:",df_outflow$region,"<br/>",
"Duration:",df_outflow$`Per 1,000 Rate`,"<br/>")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Outflow", popup = content_outflow,
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(df_outflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = df_outflow$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet(df_outflow) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Outflow", popup = content_outflow,
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(df_outflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = df_outflow$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
inflow_spdf <- world_spdf
outflow_spdf <- world_spdf
outflow_spdf@data <- outflow_spdf@data %>% filter(date=="2017"&type=="Outflow")
outflow_spdf@data
outflow_spdf@data$`Per 1,000 Rate`
qpal_outflow <- colorQuantile("Reds",outflow_spdf@data$`Per 1,000 Rate`)
outflow_spdf@data <- outflow_spdf@data %>% filter(date=="2017"&type=="Outflow")
qpal_outflow <- colorQuantile("Reds",outflow_spdf@data$`Per 1,000 Rate`)
df_inflow <- df %>% filter(date=="2017"&type=="Inflow")
qpal_inflow <- colorQuantile("Blues",df_inflow$`Per 1,000 Rate`)
content_inflow <- paste("Country:",df_inflow$country,"<br/>",
"Region:",df_inflow$region,"<br/>",
"Migration Rate:",df_inflow$`Per 1,000 Rate`,"<br/>")
content_outflow <- paste("Country:",outflow_spdf@data$country,"<br/>",
"Region:",outflow_spdf@data$region,"<br/>",
"Duration:",outflow_spdf@data$`Per 1,000 Rate`,"<br/>")
leaflet(outflow_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Outflow", popup = content_outflow,
stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(df_outflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = df_outflow$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Inflow",
stroke = TRUE, smoothFactor = 0.5, popup = ~country
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(df_inflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = df_inflow$`Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration Inflow Per 1000")
filter(df_inflow,df_inflow$region=="Latin America & Caribbean ")
filter(df_outflow,df_outflow$region=="Latin America & Caribbean ")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Inflow",
stroke = TRUE, smoothFactor = 0.5, popup = ~country
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(df_inflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = df_inflow$`Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration Inflow Per 1000")
filter(df_inflow,df_inflow$region=="Latin America & Caribbean ")
filter(df_outflow,df_outflow$region=="Latin America & Caribbean ")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(group = "Inflow",
stroke = TRUE, smoothFactor = 0.5, popup = ~country,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(df_inflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = df_inflow$`Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration Inflow Per 1000")
filter(df_inflow,df_inflow$region=="Latin America & Caribbean ")
filter(df_outflow,df_outflow$region=="Latin America & Caribbean ")
leaflet() %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(data =outflow_spdf, group = "Inflow",
stroke = TRUE, smoothFactor = 0.5, popup = ~country,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(df_inflow$`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = df_inflow$`Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration Inflow Per 1000")
filter(df_inflow,df_inflow$region=="Latin America & Caribbean ")
filter(df_outflow,df_outflow$region=="Latin America & Caribbean ")
leaflet() %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add inflows migration
addPolygons(data =inflow_spdf, group = "Inflow",
stroke = TRUE, smoothFactor = 0.5, popup = ~country,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(inflow_spdf@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = inflow_spdf@data$`Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration Inflow Per 1000")
df_inflow <- inflow_spdf %>% filter(date=="2017"&type=="Inflow")
qpal_inflow <- colorQuantile("Blues",df_inflow$`Per 1,000 Rate`)
df_inflow <- inflow_spdf@data %>% filter(date=="2017"&type=="Inflow")
qpal_inflow <- colorQuantile("Blues",inflow_spdf$`Per 1,000 Rate`)
qpal_inflow <- colorQuantile("Blues",inflow_spdf@data$`Per 1,000 Rate`)
outflow_spdf@data <- outflow_spdf@data %>% filter(date=="2017"&type=="Outflow")
qpal_outflow <- colorQuantile("Reds",outflow_spdf@data$`Per 1,000 Rate`)
df_inflow <- inflow_spdf@data %>% filter(date=="2017"&type=="Inflow")
qpal_inflow <- colorQuantile("Blues",inflow_spdf@data$`Per 1,000 Rate`)
leaflet() %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add inflows migration
addPolygons(data =inflow_spdf, group = "Inflow",
stroke = TRUE, smoothFactor = 0.5, popup = ~country,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_inflow(inflow_spdf@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Inflow",values = inflow_spdf@data$`Per 1,000 Rate`,
pal = qpal_inflow,title = "Migration Inflow Per 1000")
knitr::opts_chunk$set(echo = TRUE)
#install.packages('wbstats')
#install.packages('tidyverse')
library(wbstats)
library(tidyverse)
library(shiny)
library(leaflet)
library(rgdal)
df <- wb(country = "countries_only",indicator = c("SM.POP.NETM","SP.POP.TOTL"),  startdate = 1962, enddate = 2017)
world_spdf = readOGR(dsn= "data",layer="TM_WORLD_BORDERS_SIMPL-0.3")
df_outflow <- world_spdf@data %>% filter(date=="2017"&type=="Outflow")
combined
world_spdf@data %>% filter(date=="2017"&type=="Outflow")
world_spdf = readOGR(dsn= "data",layer="TM_WORLD_BORDERS_SIMPL-0.3")
world_spdf$ISO2
world_spdf_outflow <- world_spdf
leaflet() %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(data = world_spdf_outflow,stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(world_spdf_outflow@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = world_spdf_outflow@data$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
world_spdf_outflow <- world_spdf
world_spdf_outflow@data <- world_spdf_outflow@data %>% filter(date=="2017"&type=="Outflow")
qpal_outflow <- colorQuantile("Reds",world_spdf_outflow@data$`Per 1,000 Rate`)
leaflet() %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(data = world_spdf_outflow,stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(world_spdf_outflow@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = world_spdf_outflow@data$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
world_spdf_outflow@data$`Per 1,000 Rate`
world_spdf_outflow@data
world_spdf@data
#filters out non-countries
df <- filter(df, df$country!="Virgin Islands (U.S.)")
df <- filter(df, df$country!="Puerto Rico")
#adds region through joining on iso3c code
df <- df %>%
dplyr::left_join(wbstats::wbcountries() %>%
dplyr::select(iso3c, region)) %>%
tidyr::pivot_wider(
id_cols = c("date","iso3c", "country", "region"),
names_from = indicator,
values_from = value
)
#calculate per 1,000 rate
df <- mutate(df,'Per 1,000 Rate' =(df$`Net migration` / df$`Population, total`)*1000)
#round rate to two decimal places
df$`Per 1,000 Rate` <- round(df$`Per 1,000 Rate`, digits = 1)
df <- mutate(df,
type = case_when(
`Per 1,000 Rate` > 0  ~ "Inflow",
`Per 1,000 Rate` < 0  ~ "Outflow",
TRUE                  ~  "Data Not Avalilable or Marginal"
)
#omits na
#df <- na.omit(df)
#merges country coordinates based on iso coding
colnames(df)[colnames(df) == "iso3c"] <- "ISO3"
combined <- world_spdf@data %>%
left_join(df, by = c(ISO3 = "ISO3"))
#adds merged data into sp df
world_spdf@data <- combined
world_spdf_outflow <- world_spdf
world_spdf_outflow@data <- world_spdf_outflow@data %>% filter(date=="2017"&type=="Outflow")
qpal_outflow <- colorQuantile("Reds",world_spdf_outflow@data$`Per 1,000 Rate`)
leaflet() %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(data = world_spdf_outflow,stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(world_spdf_outflow@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = world_spdf_outflow@data$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet() %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(world_spdf_outflow@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = world_spdf_outflow@data$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet(world_spdf_outflow) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(world_spdf_outflow@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = world_spdf_outflow@data$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
world_spdf_outflow$type
leaflet() %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(data = world_spdf_outflow, stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5,
#fill based on immigration
fillColor = ~qpal_outflow(world_spdf_outflow@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = world_spdf_outflow@data$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet() %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(data = world_spdf_outflow, stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5, popup = ~country,
#fill based on immigration
fillColor = ~qpal_outflow(world_spdf_outflow@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = world_spdf_outflow@data$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
world_spdf_outflow@data <- world_spdf_outflow@data %>% filter(date=="2017"&type=="Outflow")
qpal_outflow <- colorQuantile("Reds",world_spdf_outflow@data$`Per 1,000 Rate`)
world_spdf_outflow@data
world_spdf_outflow@data$type
world_spdf_outflow@data[10:10]
df <- wb(country = "countries_only",indicator = c("SM.POP.NETM","SP.POP.TOTL"),  startdate = 1962, enddate = 2017)
world_spdf = readOGR(dsn= "data",layer="TM_WORLD_BORDERS_SIMPL-0.3")
#filters out non-countries
df <- filter(df, df$country!="Virgin Islands (U.S.)")
df <- filter(df, df$country!="Puerto Rico")
#adds region through joining on iso3c code
df <- df %>%
dplyr::left_join(wbstats::wbcountries() %>%
dplyr::select(iso3c, region)) %>%
tidyr::pivot_wider(
id_cols = c("date","iso3c", "country", "region"),
names_from = indicator,
values_from = value
)
#calculate per 1,000 rate
df <- mutate(df,'Per 1,000 Rate' =(df$`Net migration` / df$`Population, total`)*1000)
#round rate to two decimal places
df$`Per 1,000 Rate` <- round(df$`Per 1,000 Rate`, digits = 1)
df <- mutate(df,
type = case_when(
`Per 1,000 Rate` > 0  ~ "Inflow",
`Per 1,000 Rate` < 0  ~ "Outflow",
TRUE                  ~  "Data Not Avalilable or Marginal"
)
#omits na
#df <- na.omit(df)
#merges country coordinates based on iso coding
colnames(df)[colnames(df) == "iso3c"] <- "ISO3"
combined <- world_spdf@data %>%
left_join(df, by = c(ISO3 = "ISO3"))
#adds merged data into sp df
world_spdf@data <- combined
#world_spdf_outflow@data <- world_spdf_outflow@data %>% filter(date=="2017"&type=="Outflow")
qpal_outflow <- colorQuantile("Reds",world_spdf@data$`Per 1,000 Rate`)
leaflet() %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(data = world_spdf_outflow, stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5, popup = ~country,
#fill based on immigration
fillColor = ~qpal_outflow(world_spdf_outflow@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = world_spdf_outflow@data$`Per 1,000 Rate`,
pal = qpal_outflow,title = "Migration outflow Per 1000")
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5, popup = ~country,
#fill based on immigration
fillColor = ~qpal(world_spdf@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = world_spdf@data$`Per 1,000 Rate`,
pal = qpal,title = "Migration outflow Per 1000")
#world_spdf_outflow@data <- world_spdf_outflow@data %>% filter(date=="2017"&type=="Outflow")
qpal <- colorQuantile("Reds",world_spdf@data$`Per 1,000 Rate`)
leaflet(world_spdf) %>%
setView(lat=10, lng=0 , zoom=1) %>%
##Add outflows migration
addPolygons(stroke = TRUE, smoothFactor = 0.5,
weight=1, color='#333333', opacity=0.5, popup = ~country,
#fill based on immigration
fillColor = ~qpal(world_spdf@data$`Per 1,000 Rate`)) %>%
addLegend(group = "Outflow",values = world_spdf@data$`Per 1,000 Rate`,
pal = qpal,title = "Migration outflow Per 1000")
